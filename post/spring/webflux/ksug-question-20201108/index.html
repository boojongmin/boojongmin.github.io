<!DOCTYPE html>
<html class="no-js" lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="theme-color" content="#1b1b1b">
	<title>20201108 KSUG 질문 답변 | 기억 저장소</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="20201108 KSUG 질문 답변" />
<meta property="og:description" content="페이스북에서 KSUG 커뮤니티 글을 보다가
위와 같은 질문글을 보았는데 댓글로 달기에는 내용이 너무 많아서 죽어있던 블로그를 심폐소생해보았다.
 10개의 요청이 있고 이요청들이 모두다 DB에서 데이터를 가져 오느라 IO 요청에 시간이 걸린다면. 이것둘은 모두 Mono로 우선 리턴이 되고. 스프링 어딘가에 맵같은곳에 쌓여 있나요?
 리액티브에 대한 이해가 필요한 부분입니다. 정답만 말씀드리면 db에서 데이터를 가져올때까지 다음 코드가 실행되지 않습니다. map같은데에 저장하지는 않고 thread가 block을 하고 있는 것과 비슷합니다. db에서 데이터를 다 가져오면 mono의 다음 동작이 실행됩니다." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/spring/webflux/ksug-question-20201108/" />
<meta property="article:published_time" content="2020-11-08T22:34:22+09:00" />
<meta property="article:modified_time" content="2020-11-08T22:34:22+09:00" />

		<meta itemprop="name" content="20201108 KSUG 질문 답변">
<meta itemprop="description" content="페이스북에서 KSUG 커뮤니티 글을 보다가
위와 같은 질문글을 보았는데 댓글로 달기에는 내용이 너무 많아서 죽어있던 블로그를 심폐소생해보았다.
 10개의 요청이 있고 이요청들이 모두다 DB에서 데이터를 가져 오느라 IO 요청에 시간이 걸린다면. 이것둘은 모두 Mono로 우선 리턴이 되고. 스프링 어딘가에 맵같은곳에 쌓여 있나요?
 리액티브에 대한 이해가 필요한 부분입니다. 정답만 말씀드리면 db에서 데이터를 가져올때까지 다음 코드가 실행되지 않습니다. map같은데에 저장하지는 않고 thread가 block을 하고 있는 것과 비슷합니다. db에서 데이터를 다 가져오면 mono의 다음 동작이 실행됩니다.">
<meta itemprop="datePublished" content="2020-11-08T22:34:22+09:00" />
<meta itemprop="dateModified" content="2020-11-08T22:34:22+09:00" />
<meta itemprop="wordCount" content="437">



<meta itemprop="keywords" content="" />

		<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="20201108 KSUG 질문 답변"/>
<meta name="twitter:description" content="페이스북에서 KSUG 커뮤니티 글을 보다가
위와 같은 질문글을 보았는데 댓글로 달기에는 내용이 너무 많아서 죽어있던 블로그를 심폐소생해보았다.
 10개의 요청이 있고 이요청들이 모두다 DB에서 데이터를 가져 오느라 IO 요청에 시간이 걸린다면. 이것둘은 모두 Mono로 우선 리턴이 되고. 스프링 어딘가에 맵같은곳에 쌓여 있나요?
 리액티브에 대한 이해가 필요한 부분입니다. 정답만 말씀드리면 db에서 데이터를 가져올때까지 다음 코드가 실행되지 않습니다. map같은데에 저장하지는 않고 thread가 block을 하고 있는 것과 비슷합니다. db에서 데이터를 다 가져오면 mono의 다음 동작이 실행됩니다."/>

	<link rel="stylesheet" href="/css/bundle.css">
	<link rel="stylesheet" href="/css/custom.css">
	<link rel="icon" href="/icons/16.png" sizes="16x16" type="image/png">
	<link rel="icon" href="/icons/32.png" sizes="32x32" type="image/png">
	<link rel="manifest" href="/manifest.json">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-G3XWW8292Y', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body class="body kind-page">
	<header class="header">
	<a class="logo" href="/">기억 저장소</a>
	
</header>
	<div class="primary">
	
	<main class="main">
		
<nav class="breadcrumb block" aria-label="breadcrumb">
	<ol class="breadcrumb__list">
		
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="/">Binario</a>
		</li>
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="/post/">Posts</a>
		</li>
		<li class="breadcrumbs__item breadcrumb__item--active" aria-current="page">20201108 KSUG 질문 답변</li>
	</ol>
</nav>
		<div class="single block">
			<article class="entry">
	<div class="entry__meta meta mb">
	<time class="entry__meta-published meta-published" datetime="2020-11-08T22:34:22&#43;09:00">2020-11-08 22:34:22</time>
	</div>
				<h1 class="entry__title">20201108 KSUG 질문 답변</h1>
<details class="entry__toc toc" open>
	<summary class="toc__title"></summary>
	<nav id="TableOfContents"></nav>
</details>
				<div class="entry__content"><p>페이스북에서 KSUG 커뮤니티 글을 보다가</p>
<p><img src="../2020-11-08-22-35-02.png" alt=""></p>
<p>위와 같은 질문글을 보았는데 댓글로 달기에는 내용이 너무 많아서 죽어있던 블로그를 심폐소생해보았다.</p>
<blockquote>
<p>10개의 요청이 있고 이요청들이 모두다 DB에서 데이터를 가져 오느라 IO 요청에 시간이 걸린다면. 이것둘은 모두 Mono<!-- raw HTML omitted --> 로 우선 리턴이 되고. 스프링 어딘가에 맵같은곳에 쌓여 있나요?</p>
</blockquote>
<p>리액티브에 대한 이해가 필요한 부분입니다.
정답만 말씀드리면 db에서 데이터를 가져올때까지 다음 코드가 실행되지 않습니다. map같은데에 저장하지는 않고 thread가 block을 하고 있는 것과 비슷합니다. db에서 데이터를 다 가져오면 mono의 다음 동작이 실행됩니다.</p>
<p>CompletableFuture를 사용해보셨다면 하나의 비동기 동작이 종료되고 다음 비동기 동작을 실행이 chain 형태로 이루어지는데 mono도 <code>mono.flatmap(x -&gt; mono).flatmap(x -&gt; mono).subscribe(x -&gt; {})</code> 체인 형태로 동작을하고 객체는 바로 리턴이 되지만 onNext 이벤트를 받는 mono는 그 안에 선언적인 코드가 동작하고 onNext 이벤트를 받지 못하면 대기하는 구조입니다.</p>
<p>리액티브 프로그래밍 배경 지식 없이 mono를 이해하기는 힘드므로</p>
<p><a href="https://projectreactor.io/docs/core/release/reference">https://projectreactor.io/docs/core/release/reference</a>
위의 메뉴얼을 읽어보시거나 <a href="https://www.youtube.com/watch?v=8fenTR3KOJo">https://www.youtube.com/watch?v=8fenTR3KOJo</a> 토비님의 방송을 들어보시는 것을 추천 드립니다.</p>
<blockquote>
<p>만약 그렇다면 이벤트 대기중인 응답들을 가시적으로 볼 수 있는 방법이 있을까요?</p>
</blockquote>
<p>모르겠네요</p>
<blockquote>
<p>이런 경우 제가 생각해본 장점은 서버가 응답을 완료하기 까지 대기하는 동안에는 쓰레드를 반납하게 되니까 결론적으로는 서버에 요청을 하고 대기할수 있는 동시 접속(?)가능 개수가 확실히 증가한다고 보면 되는걸까요?</p>
</blockquote>
<p>반납이라기보다는 기존 servlet은 request 마다 thread를 생성하기 때문에 request 갯수는 thread라고 보면 되는데. 웹플럭스는 request가 몇백개라도 request IO를 처리하는 thread는 하나입니다. 쓰레드 부담이 현저하게 줄어들죠.</p>
<blockquote>
<p>다른 한가지 질문은 현재 공부를 해보니까. 서버 입장에서 비동기로 동작해도 일단 기본적인 동작은 모든 Response를 다 만들어낼 때까지 클라이언트에게 요청을 주지 않는것 같은데. 제가 잘 이해한 것이 맞나요?</p>
</blockquote>
<p>이 질문은 위의 리액티브 프로그래밍에 대한 이해가 필요한 것 같습니다. 답만 말씀드리면 사용자에게 응답을 서버에서 비지니스 로직에 관련해서 처리도하지 않고 먼저 응답을 줄수 있는 방법은 존재할수(또는 존재할 필요) 없는것 같네요.</p>
<p>선언적 프로그래밍 방식으로 함수를 전달하고 mono가 onnext 이벤트를 받으면 이때 미리 선언한 함수를 실행하는 구조로 동작을 합니다. onnext 이벤트는 언제 줄지를 알 수 없죠.(아마 이 onnext 이벤트란 용어도 처음이시라면 헤갈리실 것 같네요. 대화를 진행하려면 일단 이런게 있습니다정도로만 이해해주세요..)</p>
<blockquote>
<p>그렇다면 역시 클라이언트도 타임아웃으로 요청이 실패하거나 하는 일이 발생할 수도 있겠군요.</p>
</blockquote>
<p>기존의 servlet 방식과 동일합니다. client server socket connection이 있고 이걸 처리합니다. 이걸 thread로하느냐 nio로 하느냐 차이이므로 위의 질문은 오류로 생각하면 될 것 같습니다.</p>
<blockquote>
<p>만약 웹서버에 요청한 클라이언트도 비동기 이벤트로 서버를 기다려야 한다면 EventStream 같은 형식의 요청을 하게 되는건가요?</p>
</blockquote>
<p>그냥 단일 request/response입니다. client server 간 http는 동기적으로 이루어집니다. 비동기 이벤트가 아닙니다.</p>
<blockquote>
<p>스프링에서 제공하는 ClientAPI를 사용한다고 하면 실제로 요청은 일반 HTTP요청으로 일어나는건지 아니면 웹소켓같은 형태로 발생하는건지 아직 잘 이해가 안가네요.</p>
</blockquote>
<p>위의 답변으로 대치</p>
<blockquote>
<p>끝으로 만약에 제가 만드는 서버가 굳이 많은 요청을 동시에 처리 할 필요가 없다면. WebFlux가 주는 장점은 크게 없다고 볼 수 있을까요?</p>
</blockquote>
<p>트래픽이 많지 않다면 장점은 없습니다. 반응형 프로그램은 이벤트에 응답하는 구조라 이벤트에 반응할 함수를 만들고 미리 선언해두는 선언적 프로그래밍 방식이 될 수 밖에 없습니다. 그래서 절차적인 코드에 비해서 코드가 어렵습니다.</p>
<blockquote>
<p>질문이 길고 두서가 없었네요. 이 질문을 읽어주셨다면. 읽어주신분들 감사드립니다. 🙂</p>
</blockquote>
<p>감사합니다.</p>
</div>
				
				<footer class="entry__footer">
					
					
<div class="entry__share share">
	<a class="share__link btn" title=" Facebook" href="https://www.facebook.com/sharer/sharer.php?u=%2fpost%2fspring%2fwebflux%2fksug-question-20201108%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, ' Facebook', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Facebook" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M330 512V322h64l9-74h-73v-47c0-22 6-36 37-36h39V99c-7-1-30-3-57-3-57 0-95 34-95 98v54h-64v74h64v190z"/></svg>
	</a>
	<a class="share__link btn" title=" Twitter" href="https://twitter.com/intent/tweet/?url=%2fpost%2fspring%2fwebflux%2fksug-question-20201108%2f&amp;text=20201108%20KSUG%20%ec%a7%88%eb%ac%b8%20%eb%8b%b5%eb%b3%80" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, ' Twitter', 'width=800,height=450,resizable=yes,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
	</a>
	<a class="share__link btn" title=" Reddit" href="https://www.reddit.com/submit?url=%2fpost%2fspring%2fwebflux%2fksug-question-20201108%2f&amp;title=20201108%20KSUG%20%ec%a7%88%eb%ac%b8%20%eb%8b%b5%eb%b3%80" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, ' Reddit', 'width=832,height=624,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Reddit" role="img" width="32" height="32" viewBox="0 0 512 512"><path fill-rule="evenodd" d="M375 146a32 32 0 1 0-29-46l-65-13c-5-1-9 2-10 6l-22 97c-45 1-85 15-113 36a42 42 0 1 0-45 69l-1 12c0 65 74 117 166 117s166-52 166-117l-1-11a42 42 0 1 0-44-69c-28-21-67-35-111-37l19-86 58 13a32 32 0 0 0 32 29zM190 353c2-1 4 0 5 1 15 11 38 18 61 18s46-6 61-18a7 7 0 0 1 8 10c-18 14-44 21-69 21-25-1-51-7-69-21a6 6 0 0 1 3-11zm23-44a31 31 0 1 1-44-44 31 31 0 0 1 44 44zm130 0a31 31 0 1 0-44-44 31 31 0 0 0 44 44z"/></svg>
	</a>
	<a class="share__link btn" title=" Telegram" href="https://t.me/share/url?url=%2fpost%2fspring%2fwebflux%2fksug-question-20201108%2f&amp;title=20201108%20KSUG%20%ec%a7%88%eb%ac%b8%20%eb%8b%b5%eb%b3%80" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, ' Telegram', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
	</a>
	<a class="share__link btn" title=" LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&url=%2fpost%2fspring%2fwebflux%2fksug-question-20201108%2f&title=20201108%20KSUG%20%ec%a7%88%eb%ac%b8%20%eb%8b%b5%eb%b3%80" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, ' LinkedIn', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="LinkedIn" role="img" width="32" height="32" viewBox="0 0 512 512"><circle cx="142" cy="138" r="37"/><path stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
	</a>
	<a class="share__link btn" title=" VK" href="https://vk.com/share.php?url=%2fpost%2fspring%2fwebflux%2fksug-question-20201108%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, ' VK', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="VK" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M274 363c5-1 14-3 14-15 0 0-1-30 13-34s32 29 51 42c14 9 25 8 25 8l51-1s26-2 14-23c-1-2-9-15-39-42-31-30-26-25 11-76 23-31 33-50 30-57-4-7-20-6-20-6h-57c-6 0-9 1-12 6 0 0-9 25-21 45-25 43-35 45-40 42-9-5-7-24-7-37 0-45 7-61-13-65-13-2-59-4-73 3-7 4-11 11-8 12 3 0 12 1 17 7 8 13 9 75-2 81-15 11-53-62-62-86-2-6-5-7-12-9H79c-6 0-15 1-11 13 27 56 83 193 184 192z"/></svg>
	</a>
	<a class="share__link btn" title=" Pocket" href="https://getpocket.com/edit?url=%2fpost%2fspring%2fwebflux%2fksug-question-20201108%2f&amp;title=20201108%20KSUG%20%ec%a7%88%eb%ac%b8%20%eb%8b%b5%eb%b3%80" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, ' Pocket', 'width=480,height=320,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pocket" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M388.8 88.9H123.2A47.4 47.4 0 0 0 76 136.5v131.9c0 2.4.2 4.8.5 7.2a101.8 101.8 0 0 0-.5 10.6c0 75.6 80.6 137 180 137s180-61.4 180-137c0-3.6-.2-7.1-.5-10.6.3-2.4.5-4.8.5-7.2v-132A47.4 47.4 0 0 0 388.8 89zm-22.4 132.6l-93 93c-4.7 4.6-11 7-17.1 7a23.8 23.8 0 0 1-17.7-7l-93-93a24 24 0 0 1 33.8-33.8l76.6 76.5 76.6-76.5a24 24 0 0 1 33.8 33.8z"/></svg>
	</a>
	<a class="share__link btn" title=" Pinterest" href="https://pinterest.com/pin/create/button/?url=%2fpost%2fspring%2fwebflux%2fksug-question-20201108%2f&description=20201108%20KSUG%20%ec%a7%88%eb%ac%b8%20%eb%8b%b5%eb%b3%80" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, ' Pocket', 'width=800,height=720,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pinterest" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="m265 65c-104 0-157 75-157 138 0 37 14 71 45 83 5 2 10 0 12-5l3-18c2-6 1-7-2-12-9-11-15-24-15-43 0-56 41-106 108-106 60 0 92 37 92 85 0 64-28 116-70 116-23 0-40-18-34-42 6-27 19-57 19-77 0-18-9-34-30-34-24 0-42 25-42 58 0 20 7 34 7 34l-29 120a249 249 0 0 0 2 86l3-1c2-3 31-37 40-72l16-61c7 15 29 28 53 28 71 0 119-64 119-151 0-66-56-126-140-126z"/></svg>
	</a>
</div>
				</footer>
				
			</article>
		</div>
	</main>
	
<div class="authorbox block">
	<div class="author">
		<figure class="author__avatar">
			<img class="author__img" alt="boojongmin avatar" src="/img/avatar.jpg" height="90" width="90">
		</figure>
		<div class="author__body">
			<div class="author__name">
				boojongmin
			</div>
		</div>
	</div>
</div>
	



	
<section class="comments block">
	<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "boojongmin-github-io" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


	</div>
	<footer class="footer">
<div class="footer__social social">
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="mailto:boojongmin@gmail.com">
			<svg class="social__icon" aria-label="Email" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M299 268l124 106c-4 4-10 7-17 7H106c-7 0-13-3-17-7l124-106 43 38 43-38zm-43 13L89 138c4-4 10-7 17-7h300c7 0 13 3 17 7L256 281zm54-23l121-105v208L310 258zM81 153l121 105L81 361V153z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://github.com/boojongmin">
			<svg class="social__icon" aria-label="Github" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
		</a>
</div>
	<div class="footer__copyright">© 2020 기억 저장소. <span class="footer__copyright-credits"></span></div>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>

<script src="/js/custom.js"></script>
</body>
</html>